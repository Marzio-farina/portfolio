<app-notification 
  [notifications]="notifications()"
  [showMultiple]="true"
  [mostSevereNotification]="getMostSevereNotification()">
</app-notification>

<div class="tabs" role="tablist" aria-label="Seleziona modalità">
  <button
    class="tab"
    [class.active]="mode() === 'login'"
    role="tab"
    [attr.aria-selected]="mode() === 'login'"
    (click)="mode.set('login')">
    Accedi
  </button>
  <button
    class="tab"
    [class.active]="mode() === 'register'"
    role="tab"
    [attr.aria-selected]="mode() === 'register'"
    (click)="mode.set('register')">
    Registrati
  </button>
</div>

@if (mode() === 'login') {
  <form [formGroup]="loginForm" (ngSubmit)="submitLogin()" novalidate>

    <div class="field">
      <label for="login-email">Email</label>
      <input id="login-email" type="email" formControlName="email" autocomplete="email" required (blur)="onFieldBlur('login.email')" />
    </div>

    <div class="field password">
      <label for="login-password">Password</label>
      <input
        [type]="showLoginPass() ? 'text':'password'"
        id="login-password"
        formControlName="password"
        autocomplete="current-password"
        required (blur)="onFieldBlur('login.password')" />
      <button
        type="button"
        class="eye"
        (click)="showLoginPass.set(!showLoginPass())"
        [attr.aria-pressed]="showLoginPass()">👁️</button>
    </div>

    <button class="primary" type="submit" [disabled]="loginForm.invalid || loading()">
      {{ loading() ? 'Accesso in corso…' : 'Accedi' }}
    </button>

    <p class="hint">
      Hai dimenticato la password?
      <a href="#" (click)="$event.preventDefault(); onForgotPassword()">Recupera</a>
    </p>
  </form>
} @else {
  <form [formGroup]="registerForm" (ngSubmit)="submitRegister()" novalidate>

    <div class="field">
      <label for="reg-name">Nome</label>
      <input id="reg-name" type="text" formControlName="name" autocomplete="name" required (blur)="onFieldBlur('register.name')" />
    </div>

    <div class="field">
      <label for="reg-email">Email</label>
      <input id="reg-email" type="email" formControlName="email" autocomplete="email" required (blur)="onFieldBlur('register.email')" />
    </div>

    <div class="field password">
      <label for="reg-password">Password</label>
      <input
        [type]="showRegPass() ? 'text':'password'"
        id="reg-password"
        formControlName="password"
        autocomplete="new-password"
        required (blur)="onFieldBlur('register.password')" />
      <button
        type="button"
        class="eye"
        (click)="showRegPass.set(!showRegPass())"
        [attr.aria-pressed]="showRegPass()">👁️</button>
    </div>

    <div class="field">
      <label for="reg-confirm">Conferma password</label>
      <input
        [type]="showRegPass() ? 'text':'password'"
        id="reg-confirm"
        formControlName="confirm"
        required (blur)="onFieldBlur('register.confirm')" />
    </div>

    <div class="field checkbox">
        <input type="checkbox" id="reg-terms" formControlName="terms" (blur)="onFieldBlur('register.terms')" />
        <label for="reg-terms">
            Accetto i <a href="#" (click)="$event.preventDefault()">termini</a> e l'informativa privacy
        </label>
    </div>

    <button class="primary" type="submit" [disabled]="registerForm.invalid || loading()">
      {{ loading() ? 'Registrazione…' : 'Crea account' }}
    </button>
  </form>
}