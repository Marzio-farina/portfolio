<section class="add-testimonial">
  <div class="header">
    <button class="back-btn" (click)="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    <h2 class="title">Lascia una Recensione</h2>
  </div>

  @if (sent()) {
    <div class="success-message">
      <p>Grazie per la tua recensione!</p>
      <p class="subtitle">Ti stiamo riportando alla pagina principale...</p>
    </div>
  } @else {
    <form class="form" (ngSubmit)="submit()" [formGroup]="form" novalidate>
      <div class="row">
        <label class="field">
          <input type="text" formControlName="author_name" placeholder=" " required (blur)="onFieldBlur('author_name')"/>
          <span class="field-label">Nome</span>
          <svg class="field-icon" viewBox="0 0 24 24" aria-hidden="true" (mouseenter)="showTooltip('name')" (mouseleave)="hideTooltip('name')">
            <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
          </svg>
          <div class="field-tooltip" [class.show]="tooltipVisible === 'name'">
            Inserisci il tuo nome
          </div>
        </label>
        <label class="field">
          <input type="text" formControlName="author_surname" placeholder=" " (blur)="onFieldBlur('author_surname')"/>
          <span class="field-label">Cognome (opzionale)</span>
          <svg class="field-icon" viewBox="0 0 24 24" aria-hidden="true" (mouseenter)="showTooltip('surname')" (mouseleave)="hideTooltip('surname')">
            <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
          </svg>
          <div class="field-tooltip" [class.show]="tooltipVisible === 'surname'">
            Inserisci il tuo cognome
          </div>
        </label>
      </div>

      <div class="row">
        <label class="field">
          <input type="text" formControlName="company" placeholder=" " (blur)="onFieldBlur('company')"/>
          <span class="field-label">Azienda (opzionale)</span>
          <svg class="field-icon" viewBox="0 0 24 24" aria-hidden="true" (mouseenter)="showTooltip('company')" (mouseleave)="hideTooltip('company')">
            <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
          </svg>
          <div class="field-tooltip" [class.show]="tooltipVisible === 'company'">
            Inserisci la tua azienda
          </div>
        </label>
        <label class="field">
          <input type="text" formControlName="role_company" placeholder=" " (blur)="onFieldBlur('role_company')"/>
          <span class="field-label">Ruolo (opzionale)</span>
          <svg class="field-icon" viewBox="0 0 24 24" aria-hidden="true" (mouseenter)="showTooltip('role')" (mouseleave)="hideTooltip('role')">
            <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
          </svg>
          <div class="field-tooltip" [class.show]="tooltipVisible === 'role'">
            Inserisci il tuo ruolo
          </div>
        </label>
      </div>

      <label class="field field--textarea">
        <textarea rows="6" formControlName="text" placeholder=" " required (blur)="onFieldBlur('text')"></textarea>
        <span class="field-label">La tua recensione...</span>
        <svg class="field-icon" viewBox="0 0 24 24" aria-hidden="true" (mouseenter)="showTooltip('text')" (mouseleave)="hideTooltip('text')">
          <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
        </svg>
        <div class="field-tooltip" [class.show]="tooltipVisible === 'text'">
          Scrivi minimo 10 caratteri
        </div>
      </label>

      <label class="field">
        <span class="rating-label">Valutazione</span>
        <div class="rating-input">
          <input type="radio" name="rating" value="1" formControlName="rating" id="rating-1"/>
          <label for="rating-1">1</label>
          <input type="radio" name="rating" value="2" formControlName="rating" id="rating-2"/>
          <label for="rating-2">2</label>
          <input type="radio" name="rating" value="3" formControlName="rating" id="rating-3"/>
          <label for="rating-3">3</label>
          <input type="radio" name="rating" value="4" formControlName="rating" id="rating-4"/>
          <label for="rating-4">4</label>
          <input type="radio" name="rating" value="5" formControlName="rating" id="rating-5"/>
          <label for="rating-5">5</label>
        </div>
      </label>

      <label class="field">
        <input type="url" formControlName="avatar_url" placeholder=" " (blur)="onFieldBlur('avatar_url')"/>
        <span class="field-label">URL Avatar (opzionale)</span>
        <svg class="field-icon" viewBox="0 0 24 24" aria-hidden="true" (mouseenter)="showTooltip('avatar')" (mouseleave)="hideTooltip('avatar')">
          <path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/>
        </svg>
        <div class="field-tooltip" [class.show]="tooltipVisible === 'avatar'">
          URL dell'immagine del tuo avatar
        </div>
      </label>

      @if (error()) {
        <div class="error-message">
          {{ error() }}
        </div>
      }

      <div class="actions">
        <button type="button" class="btn btn-secondary" (click)="goBack()">
          Annulla
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="sending()">
          @if (!sending()) {
            <span>Invia Recensione</span>
          } @else if (sending()) {
            <span>Invio...</span>
          }
        </button>
      </div>
    </form>
  }
</section>
