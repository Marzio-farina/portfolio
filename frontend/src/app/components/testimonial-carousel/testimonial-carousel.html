<!-- Header con pulsante aggiungi testimonial -->
<div class="testimonials-header">
  <h3 class="sub_article-title">Testimonianze</h3>
  <button class="add-testimonial-btn" (click)="openAddTestimonial()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
  </button>
</div>

<!-- Stati di caricamento -->
@if (testimonialsLoading()) {
  <div class="state loading">Caricamentoâ€¦</div>
}
@if (!testimonialsLoading() && testimonialsError()) {
  <div class="state error">{{ testimonialsError() }}</div>
}
@if (!testimonialsLoading() && !testimonialsError() && testimonials().length === 0) {
  <div class="state empty">Nessuna testimonianza disponibile.</div>
}

<!-- Carosello testimonianze -->
@if (!testimonialsLoading() && !testimonialsError() && testimonials().length > 0) {
  <div class="testimonial-wrapper">
    <!-- Pulsanti di navigazione -->
    <button 
      class="carousel-nav-btn carousel-nav-prev" 
      (click)="scrollToPrevious()"
      [disabled]="!canScrollPrev()"
      [attr.aria-label]="'Testimonianza precedente'"
    >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m15 18-6-6 6-6"/>
      </svg>
    </button>
    
    <button 
      class="carousel-nav-btn carousel-nav-next" 
      (click)="scrollToNext()"
      [disabled]="!canScrollNext()"
      [attr.aria-label]="'Testimonianza successiva'"
    >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m9 18 6-6-6-6"/>
      </svg>
    </button>

    <div
      #carousel
      class="testimonial-track"
      (wheel)="onWheelToHorizontal($event)"
      (scroll)="onScroll()"
    >
      @for (t of testimonials(); track t.id) {
        <div class="testimonial-slide">
          <div class="testimonial-card-wrap">
            <div class="avatar-badge">
              <app-avatar [width]="56" [highlighted]="hoveredTestimonialId === t.id"></app-avatar>
            </div>
            <div class="testimonial-card">
              <app-testimonial-card
                [author]="t.author"
                [text]="t.text"
                [role]="t.role ?? ''"
                [company]="t.company ?? ''"
                [rating]="t.rating"
                (onHoverStart)="onTestimonialHoverStart(t.id)"
                (onHoverEnd)="onTestimonialHoverEnd()"
              ></app-testimonial-card>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
}