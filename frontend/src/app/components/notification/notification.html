<!-- Notifiche multiple -->
@if (showMultiple()) {
  <div class="notification-stack">
    <!-- Indicatore numero notifiche se ce ne sono molte -->
    @if (notifications().length > 5) {
      <div class="notification-counter">
        {{ notifications().length }} notifiche
      </div>
    }
    
    <!-- Notifiche visibili (accumulo indefinito) -->
    @for (notification of visibleNotifications(); track notification.id; let i = $index) {
      <div class="notification-multiple" 
           [class]="'notification-multiple--' + notification.type"
           [class.notification--edit-mode]="notification.fieldId === 'edit-mode'"
           [style.top.px]="20 + (i * 22.5)"
           [style.z-index]="notification.fieldId === 'edit-mode' ? null : (10000 - i)"
           (mouseenter)="onNotificationMouseEnter()"
           (mouseleave)="onNotificationMouseLeave()">
        
        <!-- Messaggio -->
        <div class="notification-multiple__message-container">
          <span class="notification-multiple__message">{{ notification.message }}</span>
        </div>
      </div>
    }
    
    
    <!-- Icona unificata per l'errore più grave nell'angolo -->
    @if (collapsedNotifications().length > 0) {
      <div class="notification-multiple__corner-icon" 
           [class]="'notification-multiple--' + getMostSevereCollapsedType()"
           [class.notification-corner-icon--edit-mode]="getMostSevereCollapsedType() == 'info' && hasEditModeCollapsed()"
           [style.top.px]="20"
           (mouseenter)="expandAllNotifications()"
           (mouseleave)="onCornerIconMouseLeave()"
           (click)="expandAllNotifications()"
           title="Clicca o passa il mouse per vedere tutte le notifiche">
        
        <svg class="notification-multiple__icon" viewBox="0 0 24 24" fill="currentColor">
          <path [attr.d]="getNotificationIconPath(getMostSevereCollapsedType())"/>
        </svg>
      </div>
    }
    
  </div>
}

<!-- Notifica singola (compatibilità) -->
@if (show() && !showMultiple()) {
  <!-- Contenitore principale -->
  <div #notificationElement class="notification" 
       [class]="'notification--' + type()"
       [class.notification--edit-mode]="false"
       (mouseenter)="onNotificationMouseEnter()"
       (mouseleave)="onNotificationMouseLeave()">
    
    <!-- Messaggio (si muove e scompare) -->
    <div #messageContainer class="notification__message-container">
      <span #messageElement class="notification__message">{{ message() }}</span>
    </div>
    
    <!-- Icona normale (dentro il contenitore) -->
    <div #iconContainer class="notification__icon-container" 
         [class.notification__icon-container--corner]="isIconInCorner()">
      <svg #iconElement class="notification__icon" viewBox="0 0 24 24" fill="currentColor">
        <path [attr.d]="getIconPath()"/>
      </svg>
    </div>
  </div>
  
  <!-- Icona separata per l'angolo (fuori dal contenitore padre) -->
  <div #cornerIconContainer class="notification__corner-icon" 
       [class]="'notification__corner-icon notification--' + type()"
       [style.display]="isIconInCorner() ? 'flex' : 'none'"
       (mouseenter)="expand()"
       (mouseleave)="onMouseLeave()">
    <svg class="notification__icon" viewBox="0 0 24 24" fill="currentColor">
      <path [attr.d]="getIconPath()"/>
    </svg>
  </div>
}
