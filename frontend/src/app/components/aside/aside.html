<aside class="profile">
  <div class="profile__header">
    <app-avatar/>
    <div class="profile__identity">
      <h1 class="profile__name" [title]="fullName() || '—'">{{ fullName() || '—' }}</h1>
      <p class="profile__role">Full Stack Developer</p>
    </div>

    @if (showButton()) {
      <button
        (click)="toggleContacts()"
        class="btn btn-sm profile__toggle"
        [class.is-open]="showContacts()"
        [attr.aria-expanded]="showContacts()"
        aria-controls="contacts-panel">
        <!-- Un solo SVG: la rotazione è gestita da .is-open in CSS -->
        <svg xmlns="http://www.w3.org/2000/svg"
             class="icon-16 caret"
             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             aria-hidden="true">
          <path d="M6 9l6 6 6-6"/>
        </svg>

        @if (!isSmall()) {
          <span class="profile__toggle-label">
            {{ showContacts() ? 'Hide Contacts' : 'Show Contacts' }}
          </span>
        }
      </button>
    }
  </div>

  @if (showContacts()) {
    <div id="contacts-panel" class="contacts" @expandCollapse>
      <div class="contacts__divider" role="separator" aria-hidden="true"></div>

      <!-- Stati caricamento/errore -->
      @if (loading()) {
        <div class="contact__text">Caricamento…</div>
      }
      @if (!loading() && errorMsg()) {
        <div class="contact__text text-red-600">{{ errorMsg() }}</div>
      }

      @if (!loading() && !errorMsg()) {
        <ul class="contacts__list">
          <!-- EMAIL -->
          @if (profile()?.email) {
            <li class="contact">
              <div class="contact__icon">
                <svg class="icon-20 mute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <rect x="3" y="5" width="18" height="14" rx="2"/>
                  <path d="M3 7l9 6 9-6"/>
                </svg>
              </div>
              <div class="contact__body">
                <p class="contact__label">Email</p>
                <a class="contact__link" [href]="emailHref()">{{ profile()?.email }}</a>
              </div>
            </li>
          }

          <!-- PHONE -->
          @if (profile()?.phone) {
            <li class="contact">
              <div class="contact__icon">
                <svg class="icon-20 mute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <rect x="7" y="2" width="10" height="20" rx="2" ry="2"/>
                  <line x1="12" y1="18" x2="12" y2="18"/>
                </svg>
              </div>
              <div class="contact__body">
                <p class="contact__label">Cellulare</p>
                <a class="contact__link" [href]="phoneHref()">{{ profile()?.phone }}</a>
              </div>
            </li>
          }

          <!-- CALENDAR / BIRTHDAY -->
          @if (birthdayHuman()) {
            <li class="contact">
              <div class="contact__icon">
                <svg class="icon-20 mute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <rect x="3" y="4" width="18" height="18" rx="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
              </div>
              <div class="contact__body">
                <p class="contact__label">Compleanno</p>
                <time class="contact__text" [attr.datetime]="birthdayISO() ?? undefined">
                  {{ birthdayHuman() }}
                </time>
              </div>
            </li>
          }

          <!-- LOCATION -->
          @if (locationTxt()) {
            <li class="contact">
              <div class="contact__icon">
                <svg class="icon-20 mute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path d="M12 21s-6-5.686-6-10a6 6 0 1 1 12 0c0 4.314-6 10-6 10z"/>
                  <circle cx="12" cy="11" r="2.5"/>
                </svg>
              </div>
              <div class="contact__body">
                <p class="contact__label">Posizione</p>
                <address class="contact__text">{{ locationTxt() }}</address>
              </div>
            </li>
          }
        </ul>

        <div class="contacts__divider" role="separator" aria-hidden="true"></div>

      <!-- SOCIAL DINAMICI -->
        <ul class="socials">
          @for (s of socials(); track s.provider) {
            <li>
              <a class="contact__icon" [href]="s.url!" target="_blank" rel="noopener" [attr.aria-label]="s.provider">
                @switch (iconKind(s.provider)) {
                  @case ('facebook') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M22 12a10 10 0 1 0-11.6 9.9v-7H8v-3h2.4V9.8c0-2.4 1.4-3.8 3.6-3.8 1 0 2 .2 2 .2v2.2h-1.1c-1.1 0-1.4.7-1.4 1.3V12h2.4l-.4 3h-2v6.9A10 10 0 0 0 22 12z"/>
                    </svg>
                  }
                  @case ('instagram') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <rect x="3" y="3" width="18" height="18" rx="5"/>
                      <circle cx="12" cy="12" r="3.5"/>
                      <circle cx="17.5" cy="6.5" r="1"/>
                    </svg>
                  }
                  @case ('github') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M12 .5a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.4.7-4.1-1.6-4.1-1.6-.6-1.5-1.5-1.9-1.5-1.9-1.2-.8.1-.8.1-.8 1.3.1 2 1.4 2 1.4 1.2 2 3.1 1.4 3.9 1.1.1-.9.5-1.4.8-1.7-2.7-.3-5.6-1.4-5.6-6.2 0-1.4.5-2.6 1.3-3.6-.1-.3-.6-1.7.1-3.5 0 0 1.1-.4 3.7 1.3a12.9 12.9 0 0 1 6.6 0c2.6-1.7 3.7-1.3 3.7-1.3.7 1.8.2 3.2.1 3.5.8 1 1.3 2.2 1.3 3.6 0 4.8-2.9 5.9-5.6 6.2.5.4.9 1.1.9 2.2v3.3c0 .3.2.7.9.6A12 12 0 0 0 12 .5z"/>
                    </svg>
                  }
                  @case ('linkedin') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M4.98 3.5A2.5 2.5 0 1 0 5 8.5a2.5 2.5 0 0 0-.02-5zM4 9h3.1v12H4zM10 9h3v1.6h.1A3.3 3.3 0 0 1 16.9 9c3 0 3.6 2 3.6 4.5V21H17V14.7c0-1.5 0-3.3-2-3.3s-2.3 1.6-2.3 3.2V21H10z"/>
                    </svg>
                  }
                  @case ('x') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M4 4l8 8L4 20h3l8-8-8-8H4zm13 0h3l-6.5 6.5L21 20h-3l-6.5-6.5L17 4z"/>
                    </svg>
                  }
                  @case ('youtube') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M23 7.5s-.2-1.6-.8-2.3c-.7-.8-1.5-.8-1.9-.9C17.7 4 12 4 12 4h0s-5.7 0-8.3.3c-.4 0-1.2.1-1.9.9C1.2 5.9 1 7.5 1 7.5S.8 9.4.8 11.4v1.2C.8 14.6 1 16.5 1 16.5s.2 1.6.8 2.3c.7.8 1.6.8 2 1 1.5.2 8.2.3 8.2.3s5.7 0 8.3-.3c.4 0 1.2-.1 1.9-.9.6-.7.8-2.3.8-2.3s.2-1.9.2-3.9v-1.2c0-2-.2-3.9-.2-3.9zM9.8 14.9V7.9l6.2 3.5-6.2 3.5z"/>
                    </svg>
                  }
                  @default {
                    <!-- Fallback globe -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M2 12h20M12 2a15.3 15.3 0 0 1 0 20M12 2a15.3 15.3 0 0 0 0 20"/>
                    </svg>
                  }
                }
              </a>
            </li>
          }
          
          <!-- WhatsApp dal numero, se presente -->
          @if (whatsappHref() && profile()?.phone) {
            <li>
              <a class="contact__icon" [href]="whatsappHref()!" target="_blank" rel="noopener" aria-label="Whatsapp">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 mute hover-unmute" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M20.5 3.5A11.5 11.5 0 0 0 2.7 16.2L2 22l5.9-1.6a11.5 11.5 0 0 0 12.6-16.9ZM12 19.5a7.5 7.5 0 0 1-3.8-1L8 18.3l-2.8.7.7-2.8-.2-.4A7.5 7.5 0 1 1 12 19.5Z"/>
                </svg>
              </a>
            </li>
          }
        </ul>
      }
    </div>
  }
</aside>