<section class="job-offer-detail">
  <!-- Header con back button e titolo -->
  <div class="header">
    <button class="back-btn" type="button" (click)="goBack()" aria-label="Torna alle statistiche">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    <h2 class="title">{{ title() }}</h2>
  </div>

  <!-- Pulsante Toggle Filtri -->
  <button 
    class="filter-toggle-btn" 
    (click)="toggleFilters()" 
    type="button"
    [class.active]="filtersVisible()"
    [attr.aria-label]="filtersVisible() ? 'Nascondi filtri' : 'Mostra filtri'">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
    </svg>
  </button>

  <!-- Filtro superiore - Search Bar -->
  @if (filtersVisible()) {
    <div class="top-filter">
      <div class="search-wrapper">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input 
        type="text" 
        placeholder="Cerca per azienda o posizione..." 
        class="input input-bordered search-input"
        [(ngModel)]="searchQuery"
        [value]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)">
      @if (searchQuery()) {
        <button type="button" class="clear-search" (click)="searchQuery.set('')" aria-label="Cancella ricerca">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      }
    </div>
    <button class="btn btn-outline btn-sm reset-btn" (click)="resetFilters()" type="button">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
        <path d="M3 3v5h5"/>
      </svg>
      Reset Filtri
      </button>
    </div>
  }

  <!-- Layout principale: Filtri laterali + Tabella -->
  <div class="content-layout" [class.filters-hidden]="!filtersVisible()">
    <!-- Filtri laterali -->
    @if (filtersVisible()) {
      <aside class="side-filters">
      <div class="filter-card">
        <h3 class="filter-title">Filtri</h3>

        <!-- Filtro Status -->
        <div class="filter-group">
          <label class="filter-label">Stato</label>
          <select 
            class="select select-bordered w-full"
            [(ngModel)]="selectedStatus"
            [value]="selectedStatus()"
            (ngModelChange)="selectedStatus.set($event)">
            <option value="all">Tutti</option>
            <option value="pending">In Attesa</option>
            <option value="interview">Colloquio</option>
            <option value="accepted">Accettata</option>
            <option value="rejected">Rifiutata</option>
            <option value="archived">Archiviata</option>
          </select>
        </div>

        <!-- Filtro Location -->
        <div class="filter-group">
          <label class="filter-label">Località</label>
          <select 
            class="select select-bordered w-full"
            [(ngModel)]="selectedLocation"
            [value]="selectedLocation()"
            (ngModelChange)="selectedLocation.set($event)">
            <option value="all">Tutte</option>
            @for (location of uniqueLocations(); track location) {
              <option [value]="location">{{ location }}</option>
            }
          </select>
        </div>

        <!-- Contatore risultati -->
        <div class="results-count">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          <span>{{ filteredJobOffers().length }} Risultati</span>
        </div>
      </div>
      </aside>
    }

    <!-- Tabella -->
    <div class="table-container">
      @if (loading()) {
        <div class="overflow-x-auto">
          <table class="table table-zebra">
            <thead>
              <tr>
                <th>Azienda</th>
                <th>Posizione</th>
                <th>Località</th>
                <th>Data</th>
                <th>Stipendio</th>
                <th>Stato</th>
              </tr>
            </thead>
            <tbody>
              @for (i of [0,1,2,3,4,5]; track i) {
                <tr class="skeleton-row">
                  <td>
                    <div class="skeleton skeleton-text skeleton-text--lg"></div>
                    <div class="skeleton skeleton-text skeleton-text--sm"></div>
                  </td>
                  <td>
                    <div class="skeleton skeleton-text"></div>
                  </td>
                  <td>
                    <div class="skeleton skeleton-text"></div>
                  </td>
                  <td>
                    <div class="skeleton skeleton-text skeleton-text--sm"></div>
                  </td>
                  <td>
                    <div class="skeleton skeleton-text skeleton-text--sm"></div>
                  </td>
                  <td>
                    <div class="skeleton skeleton-badge"></div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else if (filteredJobOffers().length === 0) {
        <div class="empty-state">
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="m16 16-4-4-4 4"/>
            <path d="M12 12V8"/>
          </svg>
          <h3>Nessuna candidatura trovata</h3>
          <p>Prova a modificare i filtri di ricerca</p>
        </div>
      } @else {
        <div class="overflow-x-auto">
          <table class="table table-zebra">
            <thead>
              <tr>
                <th>Azienda</th>
                <th>Posizione</th>
                <th>Località</th>
                <th>Data</th>
                <th>Stipendio</th>
                <th>Stato</th>
              </tr>
            </thead>
            <tbody>
              @for (offer of filteredJobOffers(); track offer.id) {
                <tr>
                  <td>
                    <div class="font-bold">{{ offer.company_name }}</div>
                    @if (offer.recruiter_company) {
                      <div class="text-sm text-secondary">via {{ offer.recruiter_company }}</div>
                    }
                  </td>
                  <td>{{ offer.position }}</td>
                  <td>
                    <div class="flex items-center gap-2">
                      <svg class="location-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
                        <circle cx="12" cy="10" r="3"/>
                      </svg>
                      {{ offer.location || '-' }}
                    </div>
                  </td>
                  <td>{{ offer.application_date || '-' }}</td>
                  <td>{{ offer.salary_range || '-' }}</td>
                  <td>
                    <span class="badge" [ngClass]="getStatusClass(offer.status)">
                      {{ getStatusLabel(offer.status) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>
</section>
