<h2 class="article-title">{{ title() }}</h2>

<!-- Bio component -->
<app-bio></app-bio>

<section>
    <h3 class="sub_article-title">Cosa sto facendo</h3>

    <!-- stati -->
    @if (loading()) {
        <div class="state loading">Caricamento…</div>
    }
    @if (!loading() && errorMsg()) {
        <div class="state error">{{ errorMsg() }}</div>
    }
    @if (!loading() && !errorMsg() && cards().length === 0) {
        <div class="state empty">Nessuna card disponibile.</div>
    }

    <div class="sub_article-card">
        @for (c of cards(); track c.id) {
            <app-what-i-do-card
                [title]="c.title"
                [description]="c.description"
                [icon]="c.icon ?? ''">
            </app-what-i-do-card>
        }
    </div>
</section>

<section class="testimonials">
  <div class="testimonials-header">
    <h3 class="sub_article-title">Testimonianze</h3>
    <button class="add-testimonial-btn" (click)="openAddTestimonial()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    </button>
  </div>

  @if (testimonialsLoading()) {
    <div class="state loading">Caricamento…</div>
  }
  @if (!testimonialsLoading() && testimonialsError()) {
    <div class="state error">{{ testimonialsError() }}</div>
  }
  @if (!testimonialsLoading() && !testimonialsError() && testimonials().length === 0) {
    <div class="state empty">Nessuna testimonianza disponibile.</div>
  }

  @if (!testimonialsLoading() && !testimonialsError() && testimonials().length > 0) {
    <div class="testimonial-wrapper">
      <div
        #carousel
        class="testimonial-track"
        (wheel)="onWheelToHorizontal($event)"
      >
        @for (t of testimonials(); track t.id) {
          <div class="testimonial-slide">
            <div class="testimonial-card-wrap">
              <div class="avatar-badge">
                <app-avatar [width]="56" [highlighted]="hoveredTestimonialId === t.id"></app-avatar>
              </div>
              <div class="testimonial-card">
                <app-testimonial-card
                  [author]="t.author"
                  [text]="t.text"
                  [role]="t.role ?? ''"
                  [company]="t.company ?? ''"
                  [rating]="t.rating"
                  (onHoverStart)="onTestimonialHoverStart(t.id)"
                  (onHoverEnd)="onTestimonialHoverEnd()"
                ></app-testimonial-card>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }
</section>