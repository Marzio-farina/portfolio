<!-- Notifiche multiple -->
@if (showMultiple()) {
  <div class="notification-stack">
    <!-- Indicatore notifiche -->
    @if (visibleNotifications().length > 2) {
      <div style="position: fixed; top: 10px; right: 10px; background: #f59e0b; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; z-index: 10001;">
        +{{ visibleNotifications().length - 2 }} altre
      </div>
    }
    
    <!-- Notifiche visibili (massimo 2 per ora) -->
    @for (notification of visibleNotifications().slice(0, 2); track notification.id; let i = $index) {
      <div class="notification-multiple" 
           [class]="'notification-multiple--' + notification.type"
           [style.top.px]="20 + (i * 60)"
           [style.z-index]="10000 - i"
           [attr.data-notification-id]="notification.id">
        
        <!-- Messaggio -->
        <div class="notification-multiple__message-container">
          <span class="notification-multiple__message">{{ notification.message }}</span>
          <button class="notification-multiple__close" 
                  (click)="removeNotification(notification.id)"
                  aria-label="Chiudi notifica">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        
        <!-- Barra di progresso per countdown -->
        <div class="notification-multiple__progress-bar"></div>
      </div>
    }
    
    <!-- Icona unificata per tutte le notifiche collassate -->
    @if (collapsedNotifications().length > 0) {
      <div class="notification-multiple__corner-icon notification-multiple__corner-icon--unified" 
           [style.top.px]="20"
           (mouseenter)="expandAllNotifications()"
           (mouseleave)="onCornerIconMouseLeave()">
        
        <!-- Se c'è solo una notifica, mostra la sua icona -->
        @if (collapsedNotifications().length === 1) {
          <svg class="notification-multiple__icon" viewBox="0 0 24 24" fill="currentColor">
            <path [attr.d]="getNotificationIconPath(collapsedNotifications()[0].type)"/>
          </svg>
        }
        
        <!-- Se ci sono più notifiche, mostra un'icona composita -->
        @if (collapsedNotifications().length > 1) {
          <div class="notification-multiple__composite-icon">
            @for (notification of collapsedNotifications().slice(0, 3); track notification.id; let i = $index) {
              <div class="notification-multiple__mini-icon" 
                   [class]="'notification-multiple--' + notification.type">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path [attr.d]="getNotificationIconPath(notification.type)"/>
                </svg>
              </div>
            }
            @if (collapsedNotifications().length > 3) {
              <div class="notification-multiple__more-indicator">
                +{{ collapsedNotifications().length - 3 }}
              </div>
            }
          </div>
        }
      </div>
    }
    
    <!-- Icona notifica singola collassata (se presente) -->
    @if (isIconInCorner() && show()) {
      <div class="notification__corner-icon" 
           [class]="'notification__corner-icon notification--' + type()"
           [style.top.px]="20 + (collapsedNotifications().length * 60)"
           (mouseenter)="expand()"
           (mouseleave)="onMouseLeave()">
        <svg class="notification__icon" viewBox="0 0 24 24" fill="currentColor">
          <path [attr.d]="getIconPath()"/>
        </svg>
      </div>
    }
  </div>
}

<!-- Notifica singola (compatibilità) -->
@if (show() && !showMultiple()) {
  <!-- Contenitore principale -->
  <div #notificationElement class="notification" 
       [class]="'notification--' + type()">
    
    <!-- Messaggio (si muove e scompare) -->
    <div #messageContainer class="notification__message-container">
      <span #messageElement class="notification__message">{{ message() }}</span>
    </div>
    
    <!-- Icona normale (dentro il contenitore) -->
    <div #iconContainer class="notification__icon-container" 
         [class.notification__icon-container--corner]="isIconInCorner()">
      <svg #iconElement class="notification__icon" viewBox="0 0 24 24" fill="currentColor">
        <path [attr.d]="getIconPath()"/>
      </svg>
    </div>
  </div>
  
}
